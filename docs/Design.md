## Controllers, Actions and Commands

An analysis of the current MVC design pattern in Rails, in particular how the Controllers
are designed and can be improved by employing different Design Patterns to ensure better
decoupling, single responsibility and how to aovid the typical Rails anti-pattern of flat classes, bloated with methods.

## Using Imperator Commands in the current Controller pattern

Demonstrates just how ugly the current Controller convention is!!!

```ruby
class PostController < ApplicationController
  def update    
    update_command.valid? ? update_valid : update_invalid
  end

  protected

  def update_valid
    update_command.perform and redirect_to(root_url)
  end

  def update_invalid
    render edit_post_path(command.object)
  end

  def update_command
    @update_command ||= UpdatePostCommand.new(params[:post])
  end
end
```

## Using Imperator Commands with Focused Controllers

Much nicer encapsulated logic using FocusedController :)

```ruby
module PostController
  class Update < UpdateCommandAction
    invalid_path do
      root_url
    end

    # generated by naming convention
    # command { @command ||= UpdatePostCommand.new post_hash }
  end
end
```

Demonstrating some customization of Controller logic

```ruby
module PostController
  class Update < UpdateCommandAction
    valid do
      command.perform
      redirect_to root_url
    end

    def invalid
      flash_msg "#{command.object} was invalid!", :error
      super
    end

    command { @command ||= command_class.new object_hash.merge(:status => :complete) }
  end
end
```

And more...

```ruby
module PostController
  class Update < UpdateCommandAction
    valid do
      flash_msg "#{command.object} was valid!"
      command.perform
      puts "#{command} was performed!"
      valid_redirect
    end

    valid_redirect_path do
      root_url
    end

    def invalid
      flash_msg "#{command.object} was invalid!", :error
      super
    end

    command do
      @command ||= begin
        c = UpdatePostCommand.new post_hash
        c.complete_it!
      end
    end
  end
end
```